# Preview Deployments

This document explains how to set up and use preview deployments for pull requests in the 2048 game repository.

## Table of Contents

- [Overview](#overview)
- [Available Options](#available-options)
- [Setup Instructions](#setup-instructions)
- [How It Works](#how-it-works)
- [Managing Preview Deployments](#managing-preview-deployments)
- [Troubleshooting](#troubleshooting)

## Overview

Preview deployments allow you to test changes in a live environment before merging a pull request. Every time a PR is opened or updated, an automated workflow builds and deploys a preview version of the app.

### Benefits

- ‚úÖ Test changes in a production-like environment
- ‚úÖ Share live previews with reviewers
- ‚úÖ Catch issues before merging
- ‚úÖ Test on real devices and browsers
- ‚úÖ Verify responsive design and PWA features
- ‚úÖ No manual deployment needed

## Available Options

The repository includes workflows for multiple deployment platforms:

### 1. GitHub Pages (Recommended for Free Projects)

**Pros:**
- ‚úÖ No external service needed
- ‚úÖ Free for public repositories
- ‚úÖ Uses existing GitHub infrastructure
- ‚úÖ Automatic HTTPS
- ‚úÖ Simple setup (uses GITHUB_TOKEN)

**Cons:**
- ‚ö†Ô∏è Slower deployments than specialized services
- ‚ö†Ô∏è Manual cleanup required for old previews

**Workflow:** `.github/workflows/gh-pages-preview.yml`

**Preview URL Format:** `https://prabdev01.github.io/2048/pr-{number}/`

### 2. Vercel (Recommended for Best Experience)

**Pros:**
- ‚úÖ Zero configuration needed
- ‚úÖ Automatic HTTPS
- ‚úÖ Global CDN
- ‚úÖ Free for open source
- ‚úÖ Instant deployments (< 30 seconds)
- ‚úÖ Custom domains
- ‚úÖ Analytics included
- ‚úÖ Built-in preview comments

**Cons:**
- ‚ö†Ô∏è Requires Vercel account
- ‚ö†Ô∏è Requires API tokens

**Workflow:** `.github/workflows/preview-deploy.yml`

**Preview URL Format:** `https://pr-{number}-2048.vercel.app`

**Setup Required:** See [SECRETS_SETUP.md](SECRETS_SETUP.md) for Vercel configuration

### 3. Netlify

**Pros:**
- ‚úÖ Great for static sites
- ‚úÖ Free tier available
- ‚úÖ Fast deployments
- ‚úÖ Automatic HTTPS
- ‚úÖ Form handling and functions support

**Cons:**
- ‚ö†Ô∏è Requires Netlify account
- ‚ö†Ô∏è Requires API tokens

**Workflow:** `.github/workflows/netlify-preview.yml`

**Preview URL Format:** `https://pr-{number}--2048-game.netlify.app`

**Setup Required:** See [SECRETS_SETUP.md](SECRETS_SETUP.md) for Netlify configuration

### 4. Cloudflare Pages

**Pros:**
- ‚úÖ Fastest edge network globally
- ‚úÖ Unlimited bandwidth
- ‚úÖ Free tier available
- ‚úÖ Automatic HTTPS
- ‚úÖ Great performance

**Cons:**
- ‚ö†Ô∏è Requires Cloudflare account
- ‚ö†Ô∏è Requires API tokens

**Workflow:** `.github/workflows/cloudflare-preview.yml`

**Preview URL Format:** Auto-generated by Cloudflare

**Setup Required:** See [SECRETS_SETUP.md](SECRETS_SETUP.md) for Cloudflare configuration

## Setup Instructions

### Option 1: GitHub Pages (No Setup Required)

GitHub Pages preview deployments work out of the box using the `GITHUB_TOKEN` that's automatically available in GitHub Actions.

**Enable the workflow:**

1. The workflow is already configured in `.github/workflows/gh-pages-preview.yml`
2. Open a pull request to test it
3. The preview will be available at `https://prabdev01.github.io/2048/pr-{number}/`

**Enable GitHub Pages:**

1. Go to repository Settings ‚Üí Pages
2. Set Source to "Deploy from a branch"
3. Select branch: `gh-pages`, folder: `/ (root)`
4. Click Save

### Option 2: Vercel (Best Experience)

**Step 1: Create Vercel Account**

1. Go to [vercel.com](https://vercel.com)
2. Sign up with GitHub
3. Import your repository

**Step 2: Get API Credentials**

See [SECRETS_SETUP.md](SECRETS_SETUP.md#vercel-setup) for detailed instructions on obtaining:
- `VERCEL_TOKEN`
- `VERCEL_ORG_ID`
- `VERCEL_PROJECT_ID`

**Step 3: Add Secrets to GitHub**

1. Go to repository Settings ‚Üí Secrets and variables ‚Üí Actions
2. Click "New repository secret"
3. Add all three secrets
4. The workflow will automatically start working on new PRs

### Option 3: Netlify

See [SECRETS_SETUP.md](SECRETS_SETUP.md#netlify-setup) for complete setup instructions.

### Option 4: Cloudflare Pages

See [SECRETS_SETUP.md](SECRETS_SETUP.md#cloudflare-setup) for complete setup instructions.

## How It Works

### Workflow Triggers

Preview deployments are triggered when:

1. **Pull Request Opened** - A new PR is created
2. **Pull Request Updated** - New commits are pushed to the PR
3. **Pull Request Reopened** - A closed PR is reopened

### Deployment Process

1. **Checkout Code** - The workflow checks out the PR branch
2. **Install Dependencies** - Runs `npm ci` to install dependencies
3. **Build** - Runs `npm run web:build` to create production bundle
4. **Deploy** - Uploads build to the deployment platform
5. **Comment** - Posts a comment on the PR with the preview URL

### Typical Deployment Time

- **GitHub Pages:** 2-5 minutes
- **Vercel:** 30-60 seconds
- **Netlify:** 1-2 minutes
- **Cloudflare:** 1-2 minutes

### Preview URL Structure

Each preview has a unique URL based on the PR number:

- **GitHub Pages:** `https://prabdev01.github.io/2048/pr-123/`
- **Vercel:** `https://pr-123-2048.vercel.app`
- **Netlify:** `https://pr-123--2048-game.netlify.app`
- **Cloudflare:** Auto-generated (posted in PR comment)

## Managing Preview Deployments

### Viewing Active Previews

**GitHub Pages:**
- All previews are in the `gh-pages` branch
- Navigate to: https://github.com/prabdev01/2048/tree/gh-pages
- Each PR has a folder: `pr-{number}/`

**Vercel/Netlify/Cloudflare:**
- Log in to your account dashboard
- View all deployments and previews
- Access deployment logs and analytics

### Updating a Preview

Previews automatically update when new commits are pushed to the PR:

1. Make changes in your PR branch
2. Push commits
3. Wait for the workflow to complete
4. Preview URL stays the same, but content is updated

### Cleanup

**GitHub Pages:**
- Manual cleanup workflow runs when PR is closed
- Workflow: `.github/workflows/cleanup-previews.yml`
- Removes the preview directory from `gh-pages` branch

**Vercel/Netlify/Cloudflare:**
- Previews are automatically managed by the platform
- Usually kept for 30-90 days
- Can be manually deleted from the dashboard

### Manual Cleanup (GitHub Pages)

If you need to manually remove a preview:

```bash
# Clone the gh-pages branch
git clone -b gh-pages https://github.com/prabdev01/2048.git
cd 2048

# Remove the preview directory
rm -rf pr-123

# Commit and push
git add .
git commit -m "Remove preview for PR #123"
git push
```

## Custom Domain Setup

### GitHub Pages

1. Add a `CNAME` file to the `public/` folder with your domain
2. Configure DNS to point to GitHub Pages
3. Enable HTTPS in repository settings

### Vercel

1. Go to Vercel project settings
2. Add domain under "Domains"
3. Follow DNS configuration instructions
4. Vercel handles HTTPS automatically

### Netlify

1. Go to Netlify site settings
2. Add custom domain
3. Configure DNS as instructed
4. Enable HTTPS (automatic)

### Cloudflare Pages

1. Go to Cloudflare Pages project
2. Add custom domain
3. DNS is auto-configured if using Cloudflare
4. HTTPS is automatic

## Deployment Logs

### GitHub Pages

View deployment logs in Actions tab:
1. Go to repository ‚Üí Actions
2. Find the "GitHub Pages PR Preview" workflow
3. Click on the specific run
4. View logs for each step

### Vercel/Netlify/Cloudflare

View logs in the platform dashboard:
1. Log in to your account
2. Navigate to deployments
3. Click on a specific deployment
4. View build logs and deployment details

## Troubleshooting

### Preview Not Deploying

**Check workflow status:**
1. Go to repository ‚Üí Actions
2. Find the failed workflow run
3. Check error logs

**Common issues:**

**Missing secrets:**
- Verify all required secrets are added
- Check secret names match exactly
- Ensure secrets are not expired

**Build failures:**
- Check if `npm run web:build` works locally
- Verify dependencies are up to date
- Check for syntax errors in code

**Permission issues:**
- For GitHub Pages, ensure workflow has write permissions
- For Vercel/Netlify/Cloudflare, verify API tokens have correct permissions

### Preview URL Not Working

**GitHub Pages:**
- Wait 2-5 minutes for GitHub Pages to update
- Clear browser cache
- Check if `gh-pages` branch exists
- Verify GitHub Pages is enabled in settings

**Vercel/Netlify/Cloudflare:**
- Wait for deployment to complete (check dashboard)
- Verify DNS is configured correctly
- Check platform status page for outages

### Preview Shows Old Content

**GitHub Pages:**
- Clear browser cache (Ctrl+Shift+R or Cmd+Shift+R)
- Wait for workflow to complete
- Check if new build was deployed

**Vercel/Netlify/Cloudflare:**
- Clear browser cache
- Check if deployment succeeded in dashboard
- Force a new deployment if needed

### Cleanup Not Working

**GitHub Pages:**
- Check if cleanup workflow ran successfully
- Verify workflow has write permissions
- Manually remove directory if needed

**Vercel/Netlify/Cloudflare:**
- Previews are managed automatically
- Can manually delete from dashboard

### Build Taking Too Long

- **GitHub Pages:** Normal, can take 2-5 minutes
- **Vercel:** Should be < 1 minute - check Vercel dashboard
- **Netlify:** Should be 1-2 minutes - check Netlify dashboard
- **Cloudflare:** Should be 1-2 minutes - check Cloudflare dashboard

If builds consistently take too long:
- Optimize build process
- Check for large dependencies
- Use caching effectively
- Consider upgrading platform tier

## Advanced Features

### Bundle Size Analysis

The repository includes bundle size analysis:

```bash
npm run web:analyze
```

This can be integrated into the preview workflow to show bundle size changes.

### Lighthouse CI

The Lighthouse CI workflow (`.github/workflows/lighthouse.yml`) runs automated performance, accessibility, and SEO audits on every PR.

**What it checks:**
- Performance score
- Accessibility compliance
- SEO optimization
- Best practices
- PWA readiness

**View results:**
1. Go to Actions tab
2. Find "Lighthouse CI" workflow
3. Check artifacts for detailed reports

### Status Checks

Preview deployment status appears in PR checks:
- ‚úÖ Build successful
- ‚úÖ Preview deployed
- üîó Preview URL available

## Best Practices

### Testing Checklist

When reviewing a preview deployment, test:

- [ ] Game functionality (all controls work)
- [ ] Touch/swipe gestures on mobile
- [ ] Keyboard shortcuts
- [ ] Score tracking and persistence
- [ ] Responsive design (desktop, tablet, mobile)
- [ ] PWA features (install prompt, offline mode)
- [ ] All themes and styles
- [ ] Performance (smooth animations, fast load)

### Security

- ‚úÖ Never commit API tokens or secrets
- ‚úÖ Use repository secrets for credentials
- ‚úÖ Rotate tokens periodically
- ‚úÖ Use least-privilege access for tokens
- ‚úÖ Monitor deployment logs for issues

### Performance

- ‚úÖ Keep bundle size under 500KB gzipped
- ‚úÖ Optimize images and assets
- ‚úÖ Use code splitting
- ‚úÖ Enable caching headers
- ‚úÖ Monitor Lighthouse scores

## Migration Guide

### Switching Between Platforms

If you want to change deployment platforms:

1. **Disable current workflow:**
   - Rename or delete the workflow file
   - Or add a condition to skip it

2. **Enable new workflow:**
   - Add required secrets (see SECRETS_SETUP.md)
   - Test with a draft PR

3. **Clean up old previews:**
   - Remove old preview deployments
   - Delete unused platform resources

### Running Multiple Platforms

You can run multiple preview platforms simultaneously:
- Each workflow is independent
- PRs will get multiple preview URLs
- Choose the one that works best for you

## Support

### Documentation

- [Web Build Guide](WEB_BUILD_GUIDE.md) - Building and testing the app
- [Secrets Setup](SECRETS_SETUP.md) - Configuring deployment platforms
- [Contributing Guide](../CONTRIBUTING.md) - Contributing to the project

### Getting Help

If you encounter issues:

1. Check this documentation
2. Review workflow logs in Actions tab
3. Check platform status pages
4. Open an issue on GitHub
5. Review platform documentation:
   - [Vercel Docs](https://vercel.com/docs)
   - [Netlify Docs](https://docs.netlify.com)
   - [Cloudflare Pages Docs](https://developers.cloudflare.com/pages)
   - [GitHub Pages Docs](https://docs.github.com/en/pages)

## License

This documentation is part of the 2048 game repository and is covered under the MIT License.
